!function(c){c.su.moduleManager.define("mapRouter",{services:["device","timer","ajax"],models:["statusAll","deviceNameModel","wireless24gNetworkMap","wireless5g1NetworkMap","wireless5g2NetworkMap","guest24gNetworkMap","guest5g1NetworkMap","guest5g2NetworkMap"],stores:["ethernetStatusStore"],deps:["navigatorController","networkMap"],views:["mapRouterView"],listeners:{"ev_on_launch":function(e,t,o,a,s,n,r){this.unRegisterAutoSaveData([a.statusAll,a.deviceNameModel,a.wireless24gNetworkMap,a.wireless5g1NetworkMap,a.wireless5g2NetworkMap,a.guest24gNetworkMap,a.guest5g1NetworkMap,a.guest5g2NetworkMap]),o.mapRouterView.cpuLoad.setOption(t.calculateLineOption({title:c.su.CHAR.NETWORK_MAP.CPU_LOAD,color:"#ffcd08",tooltip:{backgroundColor:"rgba(255, 203, 0, 0.8)"},name:c.su.CHAR.NETWORK_MAP.CPU_CORE_NUMBER+":"})),o.mapRouterView.memoryUsage.setOption(t.calculateLineOption({title:c.su.CHAR.NETWORK_MAP.MEMORY_USAGE,color:"#53C5D2",tooltip:{backgroundColor:"rgba(74, 203, 214, 0.8)"},areaColor:"rgba(83, 197, 210, 0.5)"})),a.deviceNameModel.load(),a.wireless24gNetworkMap.load(),a.wireless5g1NetworkMap.load(),a.guest24gNetworkMap.load(),a.guest5g1NetworkMap.load(),r.device.getIsTriband()?(o.mapRouterView.wireless5g2Fieldset.show(),o.mapRouterView.guest5g2Fieldset.show(),a.wireless5g2NetworkMap.load(),a.guest5g2NetworkMap.load()):(o.mapRouterView.wireless5g2Fieldset.hide(),o.mapRouterView.guest5g2Fieldset.hide(),a.wireless5g1NetworkMap.enable.setLabelField(c.su.CHAR.NETWORK_MAP.WIRELESS_5GHZ),a.guest5g1NetworkMap.enable.setLabelField(c.su.CHAR.NETWORK_MAP.WIRELESS_5GHZ)),!0===r.device.getConfig().supportSelectPort?(t.initBind(),"router"===r.device.getCurrentMode()?t.getWanStatus(function(e){s.ethernetStatusStore.dataObj.convert=t.wanConvert.bind(null,e),s.ethernetStatusStore.load()}):(s.ethernetStatusStore.dataObj.convert=t.wanConvert.bind(null,1),s.ethernetStatusStore.load())):s.ethernetStatusStore.load(),r.timer.setInterval(t,function(){0<t.delayInterval||(t.delayInterval=1,a.statusAll.load({success:function(e){t.delayInterval=0;e=a.statusAll.getData();n.networkMap.handleWirelessIcon(e)},fail:function(){t.delayInterval=0},error:function(){t.delayInterval=0}}))},20101,!0)}},init:function(o,a,s,e,n,t){this.control({"#map-router-wireless-button":{"ev_button_click":function(e){n.navigatorController.goTo("wirelessSettingsAdv")}},"#map-router-guest-button":{"ev_button_click":function(e){n.navigatorController.goTo("guestNetworkAdv")}},"#map-router-usb-button":{"ev_button_click":function(e){n.navigatorController.goTo("storageSharing")}},"#device-name-edit-btn":{"ev_button_click":function(e){a.mapRouterView.deviceNameMsg.show()}},"#device-name-msg-submit-btn":{"ev_button_click":function(){var e=s.deviceNameModel;e.validate()&&(e.submit({success:function(e){a.mapRouterView.deviceName.setValue(e.model)}}),a.mapRouterView.deviceNameMsg.hide())}},"#device-name-msg-cancel-btn":{"ev_button_click":function(){a.mapRouterView.deviceNameMsg.hide()}},"#wireless2g-enable-switch":{"ev_view_change":function(e,t){s.wireless24gNetworkMap.submit({data:{disabled_all:"on"==t.value?"off":"on"},success:function(e){n.networkMap.handleWirelessIcon(e.enable,"2g"),"off"==e.enable?s.guest24gNetworkMap.enable.disable():s.guest24gNetworkMap.enable.enable()}})}},"#wireless5g-enable-switch":{"ev_view_change":function(e,t){s.wireless5g1NetworkMap.submit({data:{disabled_all:"on"==t.value?"off":"on"},success:function(e){n.networkMap.handleWirelessIcon(e.enable,"5g"),"off"==e.enable?s.guest5g1NetworkMap.enable.disable():s.guest5g1NetworkMap.enable.enable()}})}},"#wireless5g2-enable-switch":{"ev_view_change":function(e,t){s.wireless5g2NetworkMap.submit({data:{disabled_all:"on"==t.value?"off":"on"},success:function(e){n.networkMap.handleWirelessIcon(e.enable,"5g-2"),"off"==e.enable?s.guest5g2NetworkMap.enable.disable():s.guest5g2NetworkMap.enable.enable()}})}},"#guestNetwork2g-enable-switch":{"ev_view_change":function(){s.guest24gNetworkMap.submit()}},"#guestNetwork5g-enable-switch":{"ev_view_change":function(){s.guest5g1NetworkMap.submit()}},"#guestNetwork5g2-enable-switch":{"ev_view_change":function(){s.guest5g2NetworkMap.submit()}}}),this.listen({"models.statusAll":{"ev_loaded":function(e,t){o.setStorage(t),o.setWirelessStatus(t),o.setPerformance(t)}},"models.deviceNameModel":{"ev_loaded":function(e,t){a.mapRouterView.deviceName.setValue(t.model),n.networkMap.setProductName(t.model)}},"models.wireless24gNetworkMap":{"ev_loaded":function(e,t){"off"==t.enable?s.guest24gNetworkMap.enable.disable():s.guest24gNetworkMap.enable.enable()}},"models.wireless5g1NetworkMap":{"ev_loaded":function(e,t){"off"==t.enable?s.guest5g1NetworkMap.enable.disable():s.guest5g1NetworkMap.enable.enable()}},"models.wireless5g2NetworkMap":{"ev_loaded":function(e,t){"off"==t.enable?s.guest5g2NetworkMap.enable.disable():s.guest5g2NetworkMap.enable.enable()}}})}},function(e,n,s,t,o,a){var r=0,i=function(){for(var e=[],t=7;t--;)e.push(0);return e}(),l=function(){for(var e=[],t=7;t--;)e.push(0);return e}(),u=function(e,t){e=e||2e3,t=t||7;for(var o=new Date,a=[];t--;)a.unshift(s(o)),o=new Date(o-e);function s(e){var t="";return t+=("0"+e.getHours()).slice(-2),t+=":",t+=("0"+e.getMinutes()).slice(-2),t+=":",t+=("0"+e.getSeconds()).slice(-2)}return a};return{delayInterval:0,initBind:function(){Function.prototype.bind||(Function.prototype.bind=function(e){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),o=this,a=function(){},s=function(){return o.apply(this instanceof a&&e?this:e,t.concat(Array.prototype.slice.call(arguments)))};return a.prototype=this.prototype,s.prototype=new a,s})},wanConvert:function(s,e){return c.map(e,function(e){var t={serial:""},o=["wan",c.su.CHAR.NETWORK_MAP.PORT_2500LAN,c.su.CHAR.NETWORK_MAP.PORT_1000LAN];for(key in e){if(!t.serial&&/\d/.test(key)){var a=/\d/.exec(key)[0];/lan/.test(key)?(t.serial=a,t.type="lan"):/wan/.test(key)&&(a=parseInt(a),t.type=s===a?o[0]:o[a])}/status/.test(key)&&(t.status=e[key]),/speed/.test(key)&&(t.speed=e[key]),/duplex/.test(key)&&(t.duplex=e[key])}return t})},getWanStatus:function(t){a.ajax.request({proxy:"wanStatusProxy",success:function(e){r="1000WAN"===e.wan_port_status?2:1,t&&t(r)},fail:function(){r=0,t&&t(r)},error:function(){r=0,t&&t(r)}})},setWirelessStatus:function(e){var t=e.wireless2gEncryption,o=e.wireless5gEncryption,a=e.wireless5g2Encryption;"none"==t?s.statusAll.wireless2gPassword.hide():s.statusAll.wireless2gPassword.show(),"none"==o?s.statusAll.wireless5gPassword.hide():s.statusAll.wireless5gPassword.show(),"none"==a?s.statusAll.wireless5g2Password.hide():s.statusAll.wireless5g2Password.show(),"none"==e.guest2g5gEncryption?s.statusAll.guest2g5gPskKey.hide():s.statusAll.guest2g5gPskKey.show()},setStorage:function(e){var t={PB:c.su.CHAR.UNIT.PB,TB:c.su.CHAR.UNIT.TB,GB:c.su.CHAR.UNIT.GB,MB:c.su.CHAR.UNIT.MB,KB:c.su.CHAR.UNIT.KB,B:c.su.CHAR.UNIT.B};function o(e){return e&&e.toUpperCase()}var a=c.su.capacityToNum(e.storageAvailable+t[o(e.storageAvailableUnit)]),s=c.su.capacityToNum(e.storageCapacity+t[o(e.storageCapacityUnit)]);n.mapRouterView.usbCapacityRate.setValue(a/s*100)},setPerformance:function(e){var t=e.cpuUsage,o=e.memUsage,a=u(2e3,7);i.shift(),i.push(t),n.mapRouterView.cpuLoad.setOption({xAxis:[{data:a}],series:{data:i}}),l.shift(),l.push(o),n.mapRouterView.memoryUsage.setOption({xAxis:[{data:a}],series:{data:l}})},calculateLineOption:function(r){return{title:{show:!1,text:(r=c.extend({title:"",color:"#ffcd08",name:"",areaColor:"rgba(255, 205, 8, 0.5)"},r)).title,textStyle:{fontSize:13},left:20},grid:{top:10,right:0,left:40,bottom:10},tooltip:c.extend({show:!0,formatter:"{c}%",textStyle:{color:"#000000",fontSize:12,lineHeight:14,fontFamily:"Arial, Sans-Serif, Geneva, Verdana"},padding:[2.6,6],position:function(e,t,o,a,s){var n="";return n+="<span>"+t.value+"%</span>",n+='<span style="display:block;position:absolute;left:'+(s.contentSize[0]/2-3+"px")+";bottom:-6px;border-top:6px solid "+r.tooltip.backgroundColor+';border-left:3px solid transparent;border-right:3px solid transparent;border-bottom:none;background-color:transparent;width:0;height:0;line-height:14px;"></span>',c(o).html(n),[e[0]-18.5,e[1]-40]}},r.tooltip),xAxis:[{name:r.name,nameLocation:"middle",nameTextStyle:{color:"#000"},type:"category",axisLine:{show:!1},axisLabel:{show:!1},axisTick:{show:!1},boundaryGap:!1,data:u(2e3,7)}],yAxis:[{max:100,min:0,interval:20,nameTextStyle:{color:"#005564"},type:"value",axisLine:{show:!1},axisTick:{show:!1},splitLine:{lineStyle:{type:"dashed"}},axisLabel:{show:!0,align:"left",textStyle:{color:"rgba(255,255,255,0.8)",fontSize:12},formatter:function(e,t){return e+"%"}}}],series:[{name:"RX",type:"line",smooth:!0,symbol:"emptyCircle",symbolSize:6,showAllSymbol:!0,legendHoverLink:!1,itemStyle:{normal:{color:r.color,borderColor:r.color}},areaStyle:{normal:{color:{x:0,y:0,x2:0,y2:1,type:"linear",globalCoord:!1,colorStops:[{offset:0,color:r.areaColor},{offset:1,color:"rgba(255, 255, 255, 0.5)"}]}}},lineStyle:{width:1},data:r.data}]}}}})}(jQuery);