!function(l){l.su.moduleManager.define("gameAccelerator",{services:["ajax","moduleLoader","moduleManager"],deps:[],models:["gameAcceleratorM"],stores:["gameAcceleratorStore"],views:["gameAcceleratorView"],listeners:{"ev_on_launch":function(e,a,n,t,c,o,r){this.unRegisterAutoSaveData([c.gameAcceleratorStore,t.gameAcceleratorM]),t.gameAcceleratorM.load({data:{operation:"getMode"},success:function(e){"on"==e.game_mode?n.gameAcceleratorView.networkMapClientPanel.show():n.gameAcceleratorView.networkMapClientPanel.hide()}}),a.getClients(),r.moduleLoader.load({module:"gameAccelerator"},{module:"bandwidth"},n.gameAcceleratorView.qosBandwidthLoader,function(){var e=r.moduleManager.get("bandwidth");e.on("ev_qos_saved",function(e){t.gameAcceleratorM.gameMode.setValue("on"),t.gameAcceleratorM.gameMode.hideLoading(),t.gameAcceleratorM.submit({data:{operation:"setMode"},success:function(e){"on"==e.gameMode?n.gameAcceleratorView.networkMapClientPanel.show():n.gameAcceleratorView.networkMapClientPanel.hide()}})}),e.on("ev_qos_save_close",function(e){t.gameAcceleratorM.gameMode.hideLoading()}),e.on("ev_qos_save_cancel",function(e){t.gameAcceleratorM.gameMode.hideLoading()})})},"ev_before_destroy":function(e,a){a.beforeDestroy()}},init:function(e,n,c,o,a,r){this.configViews({id:"gameAcceleratorView",items:[{id:"game-connected-clients-grid",configs:{columns:[{dataIndex:"deviceName",cls:"m-hide l-hide xl-hide label-empty"},{dataIndex:"deviceType",cls:"m-hide l-hide xl-hide label-empty",renderer:function(e,a){var n="",t="",c="";switch(e=e.toLowerCase()){case"pc":n="icon-pc";break;case"phone":n="icon-phone";break;case"pad":n="icon-pad";break;case"other":n="icon-other";break;default:n="icon-"+e}return a.isGaming&&(c='<span class="gaming-tag"></span>'),t+='<div class="device-type-container widget-container">',t+='<span class="icon '+n+' ">'+c+"</span>",null!=a.enableInternet&&(t+='<span class="text">'+(a.enableInternet?"":l.su.CHAR.NETWORK_MAP.INTERNET_PAUSED)+"</span>"),t+="</div>",t+='<div class="device-info-container widget-container">',t+='<div class="mac">'+a.mac+"</div>",t+='<div class="ip">'+("0.0.0.0"==a.ip?"":a.ip)+"</div>",t+="</div>"}},{text:l.su.CHAR.NETWORK_MAP.TYPE,width:"15%",dataIndex:"deviceType",cls:"s-hide",renderer:function(e,a){var n="",t="",c="";switch(e=e.toLowerCase()){case"pc":n="icon-pc";break;case"phone":n="icon-phone";break;case"pad":n="icon-pad";break;case"other":n="icon-other";break;default:n="icon-"+e}return a.isGaming&&(c='<span class="gaming-tag"></span>'),t+='<div class="device-type-container widget-container">',t+='<span class="icon '+n+' ">'+c+"</span>",null!=a.enableInternet&&(t+='<span class="text">'+(a.enableInternet?"":l.su.CHAR.NETWORK_MAP.INTERNET_PAUSED)+"</span>"),t+="</div>"}},{text:l.su.CHAR.NETWORK_MAP.INFORMATION,dataIndex:"deviceName",width:"22%",cls:"s-hide",renderer:function(e,a){var n="";if("object"===l.type(a)){var t=a.deviceName;n+='<div class="device-info-container widget-container">',n+='<div class="name" title="'+t+'">'+t+"</div>",n+='<div class="mac">'+a.mac+"</div>",n+='<div class="ip">'+("0.0.0.0"==a.ip?"":a.ip)+"</div>",n+="</div>"}return n}},{text:l.su.CHAR.GAME_ACCELERATOR.REAL_TIME_RATE,dataIndex:"downloadSpeed",renderer:function(e,a){var n,t,c="",o=function(e){var a;return a=(e=parseInt(e,10))/1024<1?(0!==e&&(e=(e/1024).toFixed(2)),l.su.CHAR.NETWORK_MAP.KBPS):e/1024/1024<1?(e/1024<1e3?e=(e/1024).toFixed(1):e/=1024,l.su.CHAR.NETWORK_MAP.KBPS):(e=(e/1024/1024).toFixed(1),l.su.CHAR.NETWORK_MAP.MBPS),{speed:e,unit:a}};return"object"===l.type(a)&&(n=o(a.downloadSpeed),t=o(a.uploadSpeed),a.latency,c+='<div class="speed-upload-container widget-container">',c+='<span class="icon"></span>',c+='<span class="text">'+t.speed+"</span>",c+='<span class="unit">'+t.unit+"</span>",c+="</div>",c+='<div class="speed-download-container widget-container">',c+='<span class="icon"></span>',c+='<span class="text">'+n.speed+"</span>",c+='<span class="unit">'+n.unit+"</span>",c+="</div>"),c}},{text:l.su.CHAR.GAME_ACCELERATOR.LATENCY,dataIndex:"latency",width:"16%",cls:"s-2-col custom-action-column",tipText:l.su.CHAR.GAME_ACCELERATOR.LATENCY_HELP,renderer:function(e,a){var n="";return n+='<div class="latency-container widget-container">',n+=0<=e?'<span class="text">'+e+"</span>":'<span class="text">--- </span>',n+='<span class="unit">'+l.su.CHAR.GAME_ACCELERATOR.LATENCY_UNIT+"</span>",n+='<a href="javascript:void(0)" class="grid-content-btn grid-content-btn-latency btn-latency">',n+='<span class="icon"></span>',n+="</a>",n+="</div>"}},{text:l.su.CHAR.GAME_ACCELERATOR.GAMEING_DURATION,dataIndex:"totalGameTime",cls:"s-2-col",renderer:function(e,a){var n,t,c="",o=e;c+='<div class="duration-container widget-container">',r=parseInt(o/1440,10),n=parseInt(o%86400/60,10),t=parseInt(o%60,10),1===r?c=c+r+" "+l.su.CHAR.NETWORK_MAP.DAY+" ":1<r&&(c=c+r+" "+l.su.CHAR.NETWORK_MAP.DAYS+" "),0<n&&(c=c+n+" "+l.su.CHAR.NETWORK_MAP.H+" "),c=c+t+" "+l.su.CHAR.NETWORK_MAP.MIN,c+=" ("+l.su.CHAR.GAME_ACCELERATOR.TOTAL+")</div>";var r,i,s,d=a.currentGameTime;return c+='<div class="duration-container widget-container">',dayCurrent=parseInt(d/1440,10),i=parseInt(d%86400/60,10),s=parseInt(d%60,10),1===dayCurrent?c=c+dayCurrent+" "+l.su.CHAR.NETWORK_MAP.DAY+" ":1<dayCurrent&&(c=c+dayCurrent+" "+l.su.CHAR.NETWORK_MAP.DAYS+" "),0<i&&(c=c+i+" "+l.su.CHAR.NETWORK_MAP.H+" "),c=c+s+" "+l.su.CHAR.NETWORK_MAP.MIN,c+=" ("+l.su.CHAR.GAME_ACCELERATOR.CURRENT+")</div>"}}]}}]}),this.control({"#game-connected-clients-grid => .btn-latency":{"ev_grid_action_click":function(e,a){var n=o.gameAcceleratorStore.getModelByKey(a),t=n.ip.getValue();r.ajax.request({proxy:"gameAccGridProxy",method:"read",data:{ip:t,operation:"getLatency"},success:function(e){n.latency.setValue(e.latency)},error:function(e){},fail:function(e){}})}},"#game-accelerator-enable":{"ev_view_change":function(e,a){c.gameAcceleratorM.submit({data:{operation:"setMode"},success:function(e){"on"==e.gameMode?n.gameAcceleratorView.networkMapClientPanel.show():n.gameAcceleratorView.networkMapClientPanel.hide()}})},"ev_view_will_change":function(e,a){var n=c.gameAcceleratorM.gameMode.getValue();if("off"==n||!n){var t=r.moduleManager.get("bandwidth");t.hasConfigured()||(a.preventDefault(),c.gameAcceleratorM.gameMode.showLoading("on"),t.showBandwithMsg())}}}}),this.listen({"stores.gameAcceleratorStore":{"ev_data_change":function(e,a,n){var t=n.getName();a.value!==a.oldValue&&"enablePriority"===t&&o.gameAcceleratorStore.sync()}}})}},function(e,a,n,t,c,o){var r=null;return{getClients:function(){var e={data:{operation:"loadDevice"},success:function(e){t.gameAcceleratorStore.load({data:{operation:"loadSpeed"}})}};t.gameAcceleratorStore.load(e),clearInterval(r),r=setInterval(function(){t.gameAcceleratorStore.load({data:{operation:"loadSpeed"}})},1e4)},getAccessControlMode:function(e){var a;e&&(a=e.success),n.accessControl.load({success:function(e){a&&a(n.accessControl.getData())}})},beforeDestroy:function(){clearInterval(r)},getIPaddr:function(e){return""},getConnectType:function(e){return""}}})}(jQuery);